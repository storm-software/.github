name: Update Profile

on:
  ## Trigger on merge event to main brnach
  push:
    branches:
      - main
    paths:
      - "generate_profile.sh"
      - "repository_list.txt"
      - ".github/workflows/*"
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *" # Run every night at midnight

jobs:
  update-profile:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Generate Profile
        run: ./generate_profile.sh repository_list.txt

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.STORM_BOT_GITHUB_TOKEN }}
          commit-message: "Update Profile README with new repositories"
          committer: "Stormie-Bot <support@stormsoftware.com>"
          author: "Stormie-Bot <support@stormsoftware.com>"
          base: "main"
          title: "Update the Profile README with new repositories"
          body: |
            Update repository list in the Profile README with the latest repositories.
            - More information can be found by reading [this article][1]
            - Auto-generated by [create-pull-request][1]
            - This PR was created by [Stormie-Bot][2]

            [1]: https://dev.to/tungbq/github-create-your-own-repository-landscape-16i5
            [2]: https://github.com/Stormie-Bot
          labels: "update, automated-pr"
